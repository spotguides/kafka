name: 'Kafka Spotguide'
description: 'Production grade Kafka on Kubernets'
tags: ['Kafka', 'Big Data', 'Zookeeper', 'Queue']
resources:
  sumCpu: 8
  sumMem: 12
  filters: []
  sameSize: false
  onDemandPct: 25
  minNodes: 3
  maxNodes: 4
questions:
- type: pipeline
  dataType: enum
  key: kafka_version_enum
  label: Kafka Version
  default: 2.12-2.1.0
  required: true
  group: Kafka
  options:
    - 2.12-2.1.0
    - 2.11.1.1.1
  targets:
    - deploy_kafka.deployment.values.image.tag
- type: pipeline
  dataType: number
  label: Number of Kafka brokers
  default: 3
  group: Kafka
  required: true
  min: 1
  targets:
    - deploy_kafka.deployment.values.brokers.replicas
- type: pipeline
  dataType: string
  label: Persistent Volume size
  pattern: ^\d+(E|P|T|G|M|K|Ei|Pi|Ti|Gi|Mi|Ki)?$
  default: 10Gi
  required: true
  group: Kafka
  targets:
    - deploy_kafka.deployment.values.brokers.disk.size
- type: pipeline
  dataType: enum
  key: ssl
  description: Rest Proxy can only be enabled when brokers are communication via plaintext because proxy does not support SSL/SCRAM connections to brokers
  label: Enable SSL for Kafka
  default: both
  required: true
  options:
    - both
    - internal
    - external
    - none
  group: Kafka
  targets:
    - deploy_kafka.deployment.values.brokers.ssl.mechanism
- type: pipeline
  dataType: boolean
  key: saslscarm
  disabled: true
  label: Enable SASL/SCRAM for Kafka
  default: true
  group: Kafka
  showIf:
    properties:
      ssl:
        enum:
          - both
          - internal
          - external
  targets:
    - deploy_kafka.deployment.values.brokers.sasl.enabled
- type: secret
  name: sslkeys
  description: Only the host and the name field is required during generating the ssl secret. We are going to support ssl.endpoint.identification.algorithm=https soon, but now use localhost as a host.
  dataType: tls
  required:
    input: false
    hosts: true
  default:
    hosts: localhost
  label: SSL keys for Kafka
  group: Kafka
  showIf:
    properties:
      ssl:
        enum:
          - both
          - internal
          - external
  targets:
    - name: install_ssl_secrets.clusterSecret.sourceSecretName
    - name: deploy_kafka.deployment.values.banzaicloud.sslcerts.name
- type: secret
  name: auth
  dataType: password
  label: SASL/SCRAM auth credentials
  group: Kafka
  default:
    username: username
  required:
    username: true
  showIf:
    properties:
      ssl:
        enum:
          - both
          - internal
          - external
  targets:
    - name: install_sasl_secrets.clusterSecret.sourceSecretName
    - name: deploy_kafka.deployment.values.banzaicloud.saslauth.name
- type: pipeline
  dataType: string
  controlType: code
  config:
    mode: properties
  label: Broker properties
  group: Kafka
  required: false
  description: Any Kafka Broker config can be set here except zookeeper.connect, log.dirs, broker.id, all sasl. and ssl. related ones. These settings are taken care of by the Spotguide.
  default: |
    default.replication.factor=3
    num.partitions=3
  targets:
    - deploy_kafka.deployment.values.brokers.config
- type: pipeline
  dataType: number
  label: Number of Zookeeper nodes
  default: 3
  min: 1
  pattern: ^\d*[13579]$
  required: true
  group: Zookeeper
  targets:
    - deploy_zk.deployment.values.cluster.size
- type: pipeline
  dataType: boolean
  label: Schema Registry enabled
  default: true
  description: By enabling true, does not installs the Schema Registry. It just gives a thorough guide how to install it.
  group: Schema Registry
  targets:
    - deploy_kafka.deployment.values.schemaRegistry.enabled
- type: pipeline
  dataType: string
  label: Zookeeper server address
  required: true
  default: zookeeper-cluster-client.zookeeper:2181
  group: Kafka
  targets:
    - deploy_kafka.deployment.values.zk.url
- type: pipeline
  dataType: boolean
  label: Rest Proxy enabled
  default: true
  group: Rest Proxy
  showIf:
    properties:
      ssl:
        enum:
          - none
          - external
  targets:
    - deploy_kafka.deployment.values.restProxy.enabled
