pipeline:

  package_zookeeper:
    image: lachlanevenson/k8s-helm:latest
    commands:
      - helm init -c
      - helm package ./.banzaicloud/charts/zookeeper

  deploy_zk:
    image: banzaicloud/ci-pipeline-client:0.10
    action: EnsureDeployment
    deployment:
      name: './zookeeper-0.0.1.tgz'
      releaseName: '{{ .CICD_REPO_NAME }}-zk'
      namespace: zookeeper
  
  package_kafka_operator:
    image: lachlanevenson/k8s-helm:latest
    commands:
      - helm init -c
      - helm package ./.banzaicloud/charts/kafka-operator

  deploy_kafka_operator:
    image: banzaicloud/ci-pipeline-client:0.10
    action: EnsureDeployment
    deployment:
      name: './kafka-operator-0.2.0.tgz'
      releaseName: '{{ .CICD_REPO_NAME }}-kafka-operator'
      namespace: kafka

  package_kafka:
    image: lachlanevenson/k8s-helm:latest
    commands:
      - helm init -c
      - helm package ./.banzaicloud/charts/spotguide-kafka

  deploy_kafka:
    image: banzaicloud/ci-pipeline-client:0.10
    action: EnsureDeployment
    deployment:
      name: './spotguide-kafka-1.0.1.tgz'
      releaseName: '{{ .CICD_REPO_NAME }}'
      namespace: kafka